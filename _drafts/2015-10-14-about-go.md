---
layout: post
title: Beginner Thought of Go
summary : ""
description : ""
date: '2015-10-14T14:30:00+2000'
author: Mohamed Bassem
image: /img/parallelize-it-with-docker/building-the-rack.JPG
tags:
  - go
  - golang
categories :
---

Few months ago, I decided to revise my knowledge of programming languages and check whether I'm up to date with the current technologies or not. I learned Java in my 1st year in the university and it has been my main programming language in the [university](https://github.com/MohamedBassem/RDBMS-T2) [projects](https://github.com/MohamedBassem/pipelined-MIPS-simulator) for almost two years. I liked Java back then. Java code seems very organized and readable but coding in Java is very boring. Everything seems too old. Lots of code to do trivial things, even if it's automatically generated. But mainly, Java didn't seem the suitable language to fulfill my passion at that time, Competitive programming.

Some of the main things you care about in competitive programming are the runtime and how fast your solution is. Compared to C++, Java fails in both of them. I decided to switch to C++ for competitive programming. C++ macros can make you code the solution faster. C++ STL contains most of the things that you may need. From the runtime point of view, C++ is significantly faster. If there is a reason to solve a problem in Java, it would be Java's BigInteger class. My knowledge of C++ was limited to competitive programming until we had to do a [project](https://github.com/medo/raafat-elhagan) in the [graphics](https://github.com/MohamedBassem/tetris) course of the university using OpenGL and C++. That's when I knew I know nothing about C++. This happened once more a year later during my internship in @zoobeapp when I had some tasks on a huge C++ project under the mentorship of (Agustin) who is the very talented C++ developer.  Will I ever write a web app in C++? Never!

(Screenshot of Agustin code review).

Beside C++ and Java, I started learning python. I did some [project](https://github.com/MohamedBassem/dTests) in python also as a practice. Honestly I didn't give python enough time and effort specially that I was also learning ruby at the same time and it was more interesting for me. I started to learn ruby during my internship in @Trustious. Ruby has a very good community and libraries and also coding in ruby is fun. Rails is awesome too. Then I started exploring Node.js. Honestly, I can't imagine writing a big project in javascript. Anyways, I didn't dig deep into any of those three languages.

At that point, I couldn't answer the "What's your main programming language?" question. Even in an internship interview at Google, I solved the algorithm problem in C++ and the design problem in Java, Which honestly was awful. I decided I want to learn something new and dig deeper into it. I spend lots of time on [Hacker News](https://news.ycombinator.com/), that's where I first new about Google's golang. I started learning go and did some [side](https://github.com/MohamedBassem/getaredis) [projects](https://github.com/MohamedBassem/servgo) using it and I actually like it. Few weeks ago, I started building a big sized backend service for @zoobeapp using go.

In this blog post I'll be taking about my thoughts of go after using it for few months now.

###Go

####Concurrency Model

Go has an awesome concurrency model. Start a function in background is as easy as prepending the keyword "go" to the function call. This runs the function in a separate lightweight thread of execution that is called goroutine. Communication between different goroutines is done using what's called a channel. So for example implementing the producer-consumer pattern in go would be something like :


{% highlight go %}
package main

import (
	"fmt"
	"time"
)

func consumer(id int, queue chan string) {
	for {
		str := <-queue
		fmt.Printf("Consumer %v : %v\n", id, str)
	}
}

func producer(queue chan string) {
	for i:=0; i < 20; i++{
		queue <- fmt.Sprintf("New Job %v", i)
		time.Sleep(time.Second)
	}
}

func main() {
	maxBuffer := 20
	numConsumers := 3
	jobQueue := make(chan string, maxBuffer)
	for i := 0; i < numConsumers; i++ {
		go consumer(i, jobQueue)
	}
	producer(jobQueue)
}
{% endhighlight %}

You can run this example here : [https://play.golang.org/p/2kg6QwySS6](https://play.golang.org/p/2kg6QwySS6)

####Panics and Errors

Go has a different method for handling errors. It doesn't have the concept of exceptions. Instead, since functions can return multiple params, errors are returned as a function return param. There have been lots of discussion about this in the golang mailing list. As for me, I can't really determine whether I like this new model or not.

{% highlight go %}
if err != nil {
    return nil, err
}
{% endhighlight %}

Since errors doesn't propagate by default, my code is filled with this block. But at the same time I've always hated the try and catch block of Java in my code. I guess it's just a matter of taste.

Go also have what's called `panic` and `recover` but it's not encouraged to use them as `throw` and `catch` and they even behave differently.

####One-Liners

I'm a big fan of one-liners. I've always felt the accomplishment by chaining methods in ruby together. Since functions in Go can have multiple returns, and in most of the time it will have an extra param for error. And since return params are not indexable, function chaining is not easy anymore.

####Defer

One of the things that I like the most in go is the `defer` keyword. Defer pushes a function in a functions stack that are executed when the surrounding function returns. So instead of opening a file and having to close it before each return, you can just defer it after you've opened it directly.


{% highlight go %}

func dummy() {
    mutex.Lock()
    defer mutex.Unlock()
    // ...
}

{% endhighlight %}

####Reflecting Types

*Don't know if that's the suitable name*

In go, you can't do something like `"user".camelize.constantize.first`. You can't instantiate an instance of a struct having it's name as a string. The way this can be done is maintaining a large `map[string]interface{}` with a name to class instance mapping. Till now I didn't find a good way to maintain such this map.

####Go-Vim

(Go-Vim)() became one of my favourite vim plugins. With the help of go native tools, Go-Vim provides:

- Automatic code formatting on save. Using `go fmt`, Yes go has a standard formating!
- Automatically importing packages.
- Going to variable definition.
- Going to the documentation of a function.

And many other things that you can find in its repo.

####Packages

I've a problem structuring my go code. Go files in the same directory must be in the same package. Packages can be built and even pulled on their own. Having this in mind kind of discourses me from separating my go files into directories. I need something that bound some files that's stronger than having all the files in the same package and weaker than separating them into completely independent package on their own. Some advice is needed here please :blush:

####Encapsulation

Go fields and methods have two modes. Either public or private depending on the case of the first character. Go's private is Java's protected. Meaning that any private field or method in a struct can be accessed by any function in the same package. Sometimes that's not what I want and I don't want to separate that class into a separate package for the reasons I mentioned when talking about packages.

####Interfaces

Most of posts I've read mentions Go interfaces as one the best language features. I understand the basic concept of implicitly implementing the interface but still couldn't fully leverage its powers, so I'd really appreciate if you'd point some good posts for me.

####Misc

- Go is a compiled language. It can be compiled into a single completely independent binary. You can also cross compile go code to different OS or architecture. This makes deploying go programs very easy.
- Go is garbage-collected language so you don't have to care about freeing unneeded objects. The garbage collector gets better with every new version.

### Resources

If you are starting to learn go, those are some of the resources that helped me learn it.

- [Effective go](https://golang.org/doc/effective_go.html).
- [Learn X in Y minutes](http://learnxinyminutes.com/docs/go/).
- [Go Subreddit](https://www.reddit.com/r/golang/).
- [Go by Example](https://gobyexample.com/).
- [Go Forum](https://forum.golangbridge.org/) - It's still new.
- [Awesome Go](https://github.com/avelino/awesome-go).

My experience in go is only few months so I'm still a beginner. All of these points are just my thoughts that may or may not be wrong. If you have any thoughts/resources feel free to share it in the comments.
